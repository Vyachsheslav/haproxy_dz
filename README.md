# Домашнее задание к занятию "`Кластеризация и балансировка нагрузки`" - `Андрющенко Вячеслав`


---

### Задание 1

Запустите два simple python сервера на своей виртуальной машине на разных портах

Установите и настройте HAProxy, воспользуйтесь материалами к лекции по ссылке

Настройте балансировку Round-robin на 4 уровне.

На проверку направьте конфигурационный файл haproxy, скриншоты, где видно перенаправление запросов на разные серверы при обращении к HAProxy.



### Решение 1  

Настройки HaProxy 

![Настройки](/img/1.png)  

Результат запросов

![Запросы](/img/1_2.png) 

### Задание 2 

Запустите три simple python сервера на своей виртуальной машине на разных портах

Настройте балансировку Weighted Round Robin на 7 уровне, чтобы первый сервер имел вес 2, второй - 3, а третий - 4

HAproxy должен балансировать только тот http-трафик, который адресован домену example.local

На проверку направьте конфигурационный файл haproxy, скриншоты, где видно перенаправление запросов на разные серверы при обращении к HAProxy c использованием домена example.local и без него.


### Решение 2 

Перенастройка HaProxy для обращения по доменному имени и добавление веса серверам

![Настройки](/img/2.png)    


Пример обращения к серверам и распределения запросов в зависимости от веса 

![Запрос](/img/2_1.png) 

Попытка обращения без указания домена  


![Запрос](/img/2_2.png)  


### Задание 3  

Настройте связку HAProxy + Nginx как было показано на лекции.


Настройте Nginx так, чтобы файлы .jpg выдавались самим Nginx (предварительно разместите несколько тестовых картинок в директории /var/www/), а остальные запросы переадресовывались на HAProxy, который в свою очередь переадресовывал их на два Simple Python server.

На проверку направьте конфигурационные файлы nginx, HAProxy, скриншоты с запросами jpg картинок и других файлов на Simple Python Server, демонстрирующие корректную настройку.

### Решение 3 

Настройка nginx на выдачу файлов .jpg 

![nginx](/img/3_1.png)  


Настройка HaProxy обратно на простую балансировку 

![](/img/3_2.png)  

Пример обращения к серверу nginx и работы балансирощика

![Запрос](/img/3_3.png)  


Попытка обратиться к картинки и выдача ее nginx 

![Запрос](/img/3_4.png)  


### Задание  4   
Запустите 4 simple python сервера на разных портах.

Первые два сервера будут выдавать страницу index.html вашего сайта example1.local (в файле index.html напишите example1.local)

Вторые два сервера будут выдавать страницу index.html вашего сайта example2.local (в файле index.html напишите example2.local)

Настройте два бэкенда HAProxy

Настройте фронтенд HAProxy так, чтобы в зависимости от запрашиваемого сайта example1.local или example2.local запросы перенаправлялись на разные бэкенды HAProxy

На проверку направьте конфигурационный файл HAProxy, скриншоты, демонстрирующие запросы к разным фронтендам и ответам от разных бэкендов.

### Решение 4 

Настройка 2х бекэндов и одного фронтенда  


![Haproxy](/img/4.png) 


Примеры запросов к фронтенду по доменному имени и ответы от разных фронтендов

![Запрос](/img/4_1.png) 

Страница статистики HaProxy после запросов  

![Статистика](/img/4_2.png) 
